<!--
 * @Date: 2022-12-06 17:13:35
 * @LastEditors: xzz
 * @LastEditTime: 2023-03-16 16:09:25
-->
<template>
<div class="jclpanel" >
  
    <!-- <VueDragResize dragCancel=".dragbox .advertiseBox,.dragbox .footer,.dragbox  .jclmain" :isActive="true" :w="180" :h="60" :x="panelLocation.lx" :y="panelLocation.ly" :z="22" v-if="reloadDrag" :isResizable="false" @dragstop="onDragstop" > -->
    <VueDragResize dragCancel=".jclmain" dragHandle=".handleBox" :isActive="true" :w="180" :h="60" 
    :x="panelLocation.lx" :y="panelLocation.ly" :z="22" v-if="reloadDrag" :isResizable="false" 
    @dragstop="onDragstop" >
      <!-- https://github.com/kirillmurashov/vue-drag-resize/tree/v2.0.3 -->
    <div class="dragbox">
        <panelHeader />
      <Transition name="fade">
    <main class="jclmain" v-show="busStore.showMain2">

      <!-- ËØäÊñ≠Â∑•ÂÖ∑ -->
        <!-- <panelDiagnosisTool /> -->
      <!-- ‰∏ãËΩΩÂ∑•ÂÖ∑ -->
      
        <div>
            <el-dropdown placement="right-start" ref="subDropdown1" :hide-on-click="false">
              <span class="entranceBox">
                <div class="one">
                    <panelXzzLogo name="xzgj" />
                    <div class="title">‰∏ãËΩΩÂ∑•ÂÖ∑</div>
                </div>
                <panelXzzLogoyjt />
              </span>

              <template #dropdown>
             <el-dropdown-menu class="el-dropdown-menu2">
              <!-- ‰∫åÁ∫ßËèúÂçïÂºÄÂßã -->
              <el-dropdown-item class="el-dropdown-item2">
                <el-dropdown   placement="right-start" @command="imgDownload" >
                      <span class="el-dropdown-link2">
                        <div class="title2">ÂõæÁâá‰∏ãËΩΩ</div>
                        <panelXzzLogoyjt type="true"/>
                      </span>
                  <template #dropdown>
                    <el-dropdown-menu  @mouseenter.enter="openOrClose('open')"
                        @mouseleave.enter="openOrClose()">
                    <el-dropdown-item :class="`addOperateRecord ÂõæÁâá‰∏ãËΩΩ-${item.name}`"
                    :command="item.platform" v-for="item in pictureOption" :key="item.name">
                        {{ item.name }}
                    </el-dropdown-item>
                    </el-dropdown-menu>
                  </template>
                </el-dropdown>
              </el-dropdown-item>
                <!-- ‰∫åÁ∫ßËèúÂçïÁªìÊùü -->

                 <!-- ‰∫åÁ∫ßËèúÂçïÂºÄÂßã -->
              <el-dropdown-item class="el-dropdown-item2">
                <el-dropdown placement="right-start" @command="commentDownload">
                      <!-- <div class="title2">ÊúâÂõæËØÑ‰ª∑‰∏ãËΩΩ</div> -->
                      <span class="el-dropdown-link2">
                        <div class="title2">ËØÑ‰ª∑‰∏ãËΩΩ</div>
                        <panelXzzLogoyjt type="true"/>
                      </span>
                  <template #dropdown>
                    <el-dropdown-menu  @mouseenter.enter="openOrClose('open')"
                        @mouseleave.enter="openOrClose()">
                        <!-- <el-dropdown-menu  > -->
                    <el-dropdown-item :command="item.value" v-for="item in commentOptions"
                    :key="item.value">ËØÑ‰ª∑Ââç{{ item.value }}</el-dropdown-item>
                    </el-dropdown-menu>
                  </template>
                </el-dropdown>
              </el-dropdown-item>
                <!-- ‰∫åÁ∫ßËèúÂçïÁªìÊùü -->

              <el-dropdown-item  class="addOperateRecord ‰∏ãËΩΩÂ∑•ÂÖ∑-ËßÜÈ¢ë‰∏ãËΩΩ el-dropdown-item2" @click.enter="videoDownload">
                <span class="el-dropdown-link2">
                  <div class="title2" >‰∏ªÂõæËßÜÈ¢ë‰∏ãËΩΩ</div>
                </span>
              </el-dropdown-item>
            </el-dropdown-menu>
              </template>
            </el-dropdown>
      </div>

      <!-- Ë°•ÂçïÂ∑•ÂÖ∑ -->
          <panelOrderToolPanel  banId='134'/>
        <!-- Ê†áÈ¢òÂ∑•ÂÖ∑ -->
      <div >
          <el-dropdown placement="right-start" >
            <span class="entranceBox">
              <div class="one">
                <panelXzzLogo name="btgj" />
                <div class="title" >Ê†áÈ¢òÂ∑•ÂÖ∑</div>
            </div>
            <panelXzzLogoyjt />
            </span>
            <template #dropdown>
            <el-dropdown-menu>
              <el-dropdown-item class="addOperateRecord Ë¥¶Âè∑ÁÆ°ÁêÜ-Êìç‰ΩúËÆ∞ÂΩï" >Ê†áÈ¢òÈááÈõÜ</el-dropdown-item>
              <el-dropdown-item class="addOperateRecord Ë¥¶Âè∑ÁÆ°ÁêÜ-‰ªªÂä°ËøõÁ®ã" >ÊµèËßàËÆ∞ÂΩï</el-dropdown-item>
            </el-dropdown-menu>
            </template>
          </el-dropdown>
        </div>

          <panelPlainMenu logoName="home" title="ÂõûÂà∞È¶ñÈ°µ" openKey='https://www.jd.com/' :show="true"/>

          <panelPlainMenu logoName="jyfk" title="ÊàëÁöÑÂª∫ËÆÆ/ÂèçÈ¶à"  openKey="feedback" :show="busStore.userid"/>

        <!-- Ë¥¶Âè∑ÁÆ°ÁêÜ‰∏™‰∫∫‰∏≠ÂøÉ -->
          <panelAccountMange :show="busStore.userid" :userPhone="busStore.userPhone"/>

          <panelPlainMenu logoName="login" title="Ë¥¶Âè∑ÁôªÂΩï" openKey="login" :show="!busStore.userid" />

        <div  class="version">ÁâàÊú¨:{{ busStore.version }} </div>
        <!-- <xzzTest />
        <xzzTest2 /> -->
        
        <!-- <div @click="busStore.increment()">{{ count }}</div> -->
    </main>
    </Transition>

    <footer class="footer" @click="busStore.toggleShow()">
      <div class="shrink"> <panelXzzLogo :name="busStore.showMain2 ? 'shrink2': 'shrink'" /> </div>
    </footer>
      <!-- ÂπøÂëäÈù¢ÊùøÊåÇËΩΩ -->
        <panelAdvertisingPanel :openAd="busStore.showMain2" />

    </div>
    </VueDragResize>
    </div>

      <!-- ÂÖ®Âπ≥Âè∞ÂÖ¨ÂÖ±ÁªÑ‰ª∂ÊåÇËΩΩÁöÑÊÄªÂÖ•Âè£ -->
        <communalApp />


      <!-- ÂêÑÂπ≥Âè∞Ëá™Â∑±ÁöÑÂ≠êÁªÑ‰ª∂ÊåÇËΩΩ -->

    <!-- <jdScanRecord ref="ScanRecordRef"/> -->
    <!-- <jdShopDiagnosis ref="shopDiagnosisRef" /> -->
    
    <jdImageDownload />
    <jdCommentDownload />
     <!--<keywordRanking ref="zrss" /> -->
    <!-- <div class="test">
      <div class="test1" >
      <el-button type="primary" @click="test1">test1</el-button>
      </div>
      <el-button type="primary" @click="test2">test2</el-button>
    </div> -->

</template>

<script setup>

//ÂØºÂÖ•‰∏ªÂõæËßÜÈ¢ë‰∏ãËΩΩÂäüËÉΩ
import { videoDownload } from './videoDownload.js'

//Âπ≥Âè∞Áä∂ÊÄÅstore
const busStore = piniaStore()
//storeToRefsÂ¢ûÂä†ÂìçÂ∫îÊÄß,‰ΩøÁî®‰∫Üproxy,ÊâÄ‰ª•ÊôÆÈÄöÁÆÄÂçïÁ±ªÂûãÊï∞ÊçÆÈúÄË¶ÅÁî®.valueÊãøÂà∞ÂÄº, ËÄåÂ§çÊùÇÊï∞ÊçÆ‰∏çÈúÄË¶ÅÂèØ‰ª•Áõ¥Êé•.xxxËé∑Âèñ
//  ÊàñËÄÖÁõ¥Êé•busStore.xxxË∞ÉÁî®,‰πüÂÖ∑ÊúâÂìçÂ∫îÂºè
const {   panelLocation, count  } = storeToRefs(busStore) 


//Ê≥®ÂÖ•ÂáΩÊï∞Âà∞injectÈáå,ÂÖ±‰∫´ÊµèËßàÂô®Ë∞ÉËØïÈù¢ÊùøÁöÑÈ°∂Â±Çwindow
const test1 = async() => {
  function ff(){
    window.xzz$ = $
    return  window.pageConfig.product.imageList
  }
  let res =  await API.injectFn(ff)
  console.log("üöÄ ~ file: app.vue:206 ~ test1 ~ res:", res)
}
const test2 = async() => {
  function ff(){
    window.xzz$ = $
    return  window.pageConfig.product.imageList
  }
  let res =  await API.injectFn(ff)
  console.log("üöÄ ~ file: app.vue:206 ~ test1 ~ res:", res)
}

//ÊéßÂà∂‰∏âÁ∫ßËèúÂçïÁöÑÂºÄÂÖ≥
const subDropdown1 = ref(null)
const openOrClose = (val) => {
  val == 'open'? subDropdown1.value.handleOpen() : subDropdown1.value.handleClose()
}


//----------------------ÂõæÁâá‰∏ãËΩΩ------------start----------------------------------
  const pictureOption  = [ {name: 'PCÁ´Ø_ÂõæÁâá‰∏ãËΩΩ',  platform: 'pc'}, {name: 'ÁßªÂä®Á´Ø_ÂõæÁâá‰∏ãËΩΩ', platform: 'mobile'}]
  const imgDownload = platform => API.emitter.emit('imageDownload', platform)
//-------------------ÂõæÁâá‰∏ãËΩΩ------------end-------------------------------------------


//----------------------ËØÑ‰ª∑‰∏ãËΩΩ------------start----------------------------------
  const commentOptions  = [ {value: 20}, {value: 50}, {value: 100}, {value: 200}, {value: 300}]
  const commentDownload = num => API.emitter.emit('commentDownload', num)
//-------------------ËØÑ‰ª∑‰∏ãËΩΩ------------end-------------------------------------------


//---------Èù¢ÊùøÊãñÊãΩÂäüËÉΩ------start------------------
let reloadDrag = ref(true)
const onDragstop = async (e) => {
  // console.log('=========zhixing==========')
  if(panelLocation.lx == e.left && panelLocation.ly == e.top) return window.open('http://pddzd.junchenlun.com/plugs/index.html#/')
  let winHeight = window.innerHeight - 60
  let winWidth = window.innerWidth - 200
  if(e.top < 0 || e.left < 0 || e.top > winHeight || e.left > winWidth){
    reloadDrag.value = false
    setTimeout(() => { reloadDrag.value = true }, 100)
  }else{
    busStore.storeLocation({ lx: e.left, ly: e.top })   //ÁßªÂä®ÂêéÂ≠òÂÇ®ÂíåÊõ¥Êñ∞ÊúÄÊñ∞ÁöÑÂùêÊ†á
  }
}
//---------Èù¢ÊùøÊãñÊãΩÂäüËÉΩ------end------------------

const updateUserinfo = async () => {
let userInfoStore  =  await  API.getUserinfo()
  // console.log("üöÄ ~ file: app.vue:226 ~ updateUserinfo ~ userInfoStore:", userInfoStore)
  if(userInfoStore.userid == undefined) {
    API.checkLogin.addEvent()  //Ê∑ªÂä†ÂÖ®Â±ÄÁôªÂΩïÊã¶Êà™
    }else{
      API.checkLogin.removeEvent()  //ÁßªÈô§ÂÖ®Â±ÄÁôªÂΩïÊã¶Êà™
    }
    // ÂêåÊó∂ÁõëÂê¨ÁôªÂΩïÈÄÄÂá∫‰∫ã‰ª∂
    busStore.$patch((state)=>{
        state.userInfo = userInfoStore
        // state.userInfo = userInfoStore || { userid: '', userToken: '', userPhone: '', timeStamp: '' }
      })
}
onBeforeMount(async () => {
chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
  message == 'loginEvent'? updateUserinfo() : ''
  sendResponse({status: true})
  })
updateUserinfo()
API.Storage.set({platform: '‰∫¨‰∏ú'})  //ÂøÖÈ°ªÂ£∞ÊòéÊ≠§È°π,ÂÖ∂‰ªñÁã¨Á´ãÂÖ¨ÂÖ±ÁªÑ‰ª∂ÊâçËÉΩÊãøÂà∞ÂÄº
})

onMounted(async() => {
  // busStore.getLocation()
})



</script>

<style lang="scss" scoped>
@import "../../css/sass/jclpanel.scss";

.test{
  position: fixed;
  top: 30%;
  left: 20%;
  background-color: #fff;
  z-index: 22;
}

</style>